import { BABProgression, SaveProgression } from '@/types/base';

export interface ClassFeature {
  level: number;
  name: string;
  description?: string;
}

export interface ClassData {
  name: string;
  hitDie: number;
  skillRanksPerLevel: number;
  classSkills: string[];
  babProgression: BABProgression;
  saves: {
    fortitude: SaveProgression;
    reflex: SaveProgression;
    will: SaveProgression;
  };
  weaponProficiencies: string[];
  armorProficiencies: string[];
  startingWealth: string;
  classFeatures: ClassFeature[];
}

export const CORE_CLASSES: ClassData[] = [
  {
    name: 'Fighter',
    hitDie: 10,
    skillRanksPerLevel: 2,
    classSkills: [
      'Climb',
      'Craft',
      'Handle Animal',
      'Intimidate',
      'Knowledge (dungeoneering)',
      'Knowledge (engineering)',
      'Profession',
      'Ride',
      'Survival',
      'Swim',
    ],
    babProgression: BABProgression.Full,
    saves: {
      fortitude: SaveProgression.Good,
      reflex: SaveProgression.Poor,
      will: SaveProgression.Poor,
    },
    weaponProficiencies: ['Simple weapons', 'Martial weapons'],
    armorProficiencies: ['Light armor', 'Medium armor', 'Heavy armor', 'Shields', 'Tower shields'],
    startingWealth: '5d6 × 10 gp',
    classFeatures: [
      { level: 1, name: 'Bonus Feat' },
      { level: 2, name: 'Bonus Feat' },
      { level: 2, name: 'Bravery +1' },
      { level: 3, name: 'Armor Training 1' },
      { level: 4, name: 'Bonus Feat' },
      { level: 5, name: 'Weapon Training 1' },
      { level: 6, name: 'Bonus Feat' },
      { level: 6, name: 'Bravery +2' },
      { level: 7, name: 'Armor Training 2' },
      { level: 8, name: 'Bonus Feat' },
      { level: 9, name: 'Weapon Training 2' },
      { level: 10, name: 'Bonus Feat' },
      { level: 10, name: 'Bravery +3' },
    ],
  },
  {
    name: 'Cleric',
    hitDie: 8,
    skillRanksPerLevel: 2,
    classSkills: [
      'Appraise',
      'Craft',
      'Diplomacy',
      'Heal',
      'Knowledge (arcana)',
      'Knowledge (history)',
      'Knowledge (nobility)',
      'Knowledge (planes)',
      'Knowledge (religion)',
      'Linguistics',
      'Profession',
      'Sense Motive',
      'Spellcraft',
    ],
    babProgression: BABProgression.Medium,
    saves: {
      fortitude: SaveProgression.Good,
      reflex: SaveProgression.Poor,
      will: SaveProgression.Good,
    },
    weaponProficiencies: ['Simple weapons', "Deity's favored weapon"],
    armorProficiencies: ['Light armor', 'Medium armor', 'Shields'],
    startingWealth: '4d6 × 10 gp',
    classFeatures: [
      { level: 1, name: 'Aura' },
      { level: 1, name: 'Channel Energy 1d6' },
      { level: 1, name: 'Domains' },
      { level: 1, name: 'Orisons' },
      { level: 1, name: 'Spontaneous Casting' },
      { level: 3, name: 'Channel Energy 2d6' },
      { level: 5, name: 'Channel Energy 3d6' },
      { level: 7, name: 'Channel Energy 4d6' },
      { level: 9, name: 'Channel Energy 5d6' },
    ],
  },
  {
    name: 'Rogue',
    hitDie: 8,
    skillRanksPerLevel: 8,
    classSkills: [
      'Acrobatics',
      'Appraise',
      'Bluff',
      'Climb',
      'Craft',
      'Diplomacy',
      'Disable Device',
      'Disguise',
      'Escape Artist',
      'Intimidate',
      'Knowledge (dungeoneering)',
      'Knowledge (local)',
      'Linguistics',
      'Perception',
      'Perform',
      'Profession',
      'Sense Motive',
      'Sleight of Hand',
      'Stealth',
      'Swim',
      'Use Magic Device',
    ],
    babProgression: BABProgression.Medium,
    saves: {
      fortitude: SaveProgression.Poor,
      reflex: SaveProgression.Good,
      will: SaveProgression.Poor,
    },
    weaponProficiencies: [
      'Simple weapons',
      'Hand crossbow',
      'Rapier',
      'Sap',
      'Shortbow',
      'Short sword',
    ],
    armorProficiencies: ['Light armor'],
    startingWealth: '4d6 × 10 gp',
    classFeatures: [
      { level: 1, name: 'Sneak Attack +1d6' },
      { level: 1, name: 'Trapfinding' },
      { level: 2, name: 'Evasion' },
      { level: 2, name: 'Rogue Talent' },
      { level: 3, name: 'Sneak Attack +2d6' },
      { level: 3, name: 'Trap Sense +1' },
      { level: 4, name: 'Rogue Talent' },
      { level: 4, name: 'Uncanny Dodge' },
      { level: 5, name: 'Sneak Attack +3d6' },
      { level: 6, name: 'Rogue Talent' },
      { level: 6, name: 'Trap Sense +2' },
      { level: 7, name: 'Sneak Attack +4d6' },
      { level: 8, name: 'Improved Uncanny Dodge' },
      { level: 8, name: 'Rogue Talent' },
      { level: 9, name: 'Sneak Attack +5d6' },
      { level: 9, name: 'Trap Sense +3' },
      { level: 10, name: 'Advanced Talents' },
      { level: 10, name: 'Rogue Talent' },
    ],
  },
  {
    name: 'Wizard',
    hitDie: 6,
    skillRanksPerLevel: 2,
    classSkills: [
      'Appraise',
      'Craft',
      'Fly',
      'Knowledge (all)',
      'Linguistics',
      'Profession',
      'Spellcraft',
    ],
    babProgression: BABProgression.Low,
    saves: {
      fortitude: SaveProgression.Poor,
      reflex: SaveProgression.Poor,
      will: SaveProgression.Good,
    },
    weaponProficiencies: ['Club', 'Dagger', 'Heavy crossbow', 'Light crossbow', 'Quarterstaff'],
    armorProficiencies: [],
    startingWealth: '2d6 × 10 gp',
    classFeatures: [
      { level: 1, name: 'Arcane Bond' },
      { level: 1, name: 'Arcane School' },
      { level: 1, name: 'Cantrips' },
      { level: 1, name: 'Scribe Scroll' },
      { level: 5, name: 'Bonus Feat' },
      { level: 10, name: 'Bonus Feat' },
    ],
  },
  {
    name: 'Barbarian',
    hitDie: 12,
    skillRanksPerLevel: 4,
    classSkills: [
      'Acrobatics',
      'Climb',
      'Craft',
      'Handle Animal',
      'Intimidate',
      'Knowledge (nature)',
      'Perception',
      'Ride',
      'Survival',
      'Swim',
    ],
    babProgression: BABProgression.Full,
    saves: {
      fortitude: SaveProgression.Good,
      reflex: SaveProgression.Poor,
      will: SaveProgression.Poor,
    },
    weaponProficiencies: ['Simple weapons', 'Martial weapons'],
    armorProficiencies: ['Light armor', 'Medium armor', 'Shields'],
    startingWealth: '3d6 × 10 gp',
    classFeatures: [
      { level: 1, name: 'Fast Movement' },
      { level: 1, name: 'Rage' },
      { level: 2, name: 'Rage Power' },
      { level: 2, name: 'Uncanny Dodge' },
      { level: 3, name: 'Trap Sense +1' },
      { level: 4, name: 'Rage Power' },
      { level: 5, name: 'Improved Uncanny Dodge' },
      { level: 6, name: 'Rage Power' },
      { level: 6, name: 'Trap Sense +2' },
      { level: 7, name: 'Damage Reduction 1/—' },
      { level: 8, name: 'Rage Power' },
      { level: 9, name: 'Trap Sense +3' },
      { level: 10, name: 'Damage Reduction 2/—' },
      { level: 10, name: 'Rage Power' },
    ],
  },
  {
    name: 'Bard',
    hitDie: 8,
    skillRanksPerLevel: 6,
    classSkills: [
      'Acrobatics',
      'Appraise',
      'Bluff',
      'Climb',
      'Craft',
      'Diplomacy',
      'Disguise',
      'Escape Artist',
      'Intimidate',
      'Knowledge (all)',
      'Linguistics',
      'Perception',
      'Perform',
      'Profession',
      'Sense Motive',
      'Sleight of Hand',
      'Spellcraft',
      'Stealth',
      'Use Magic Device',
    ],
    babProgression: BABProgression.Medium,
    saves: {
      fortitude: SaveProgression.Poor,
      reflex: SaveProgression.Good,
      will: SaveProgression.Good,
    },
    weaponProficiencies: [
      'Simple weapons',
      'Longsword',
      'Rapier',
      'Sap',
      'Short sword',
      'Shortbow',
      'Whip',
    ],
    armorProficiencies: ['Light armor', 'Shields'],
    startingWealth: '3d6 × 10 gp',
    classFeatures: [
      { level: 1, name: 'Bardic Knowledge' },
      { level: 1, name: 'Bardic Performance' },
      { level: 1, name: 'Cantrips' },
      { level: 1, name: 'Countersong' },
      { level: 1, name: 'Distraction' },
      { level: 1, name: 'Fascinate' },
      { level: 1, name: 'Inspire Courage +1' },
      { level: 2, name: 'Versatile Performance' },
      { level: 2, name: 'Well-Versed' },
      { level: 3, name: 'Inspire Competence +2' },
      { level: 5, name: 'Inspire Courage +2' },
      { level: 5, name: 'Lore Master 1/day' },
      { level: 6, name: 'Suggestion' },
      { level: 6, name: 'Versatile Performance' },
      { level: 7, name: 'Inspire Competence +3' },
      { level: 8, name: 'Dirge of Doom' },
      { level: 9, name: 'Inspire Greatness' },
      { level: 10, name: 'Jack-of-All-Trades' },
      { level: 10, name: 'Versatile Performance' },
    ],
  },
  {
    name: 'Druid',
    hitDie: 8,
    skillRanksPerLevel: 4,
    classSkills: [
      'Climb',
      'Craft',
      'Fly',
      'Handle Animal',
      'Heal',
      'Knowledge (geography)',
      'Knowledge (nature)',
      'Perception',
      'Profession',
      'Ride',
      'Spellcraft',
      'Survival',
      'Swim',
    ],
    babProgression: BABProgression.Medium,
    saves: {
      fortitude: SaveProgression.Good,
      reflex: SaveProgression.Poor,
      will: SaveProgression.Good,
    },
    weaponProficiencies: [
      'Club',
      'Dagger',
      'Dart',
      'Quarterstaff',
      'Scimitar',
      'Scythe',
      'Sickle',
      'Shortspear',
      'Sling',
      'Spear',
    ],
    armorProficiencies: ['Light armor', 'Medium armor', 'Shields (non-metal only)'],
    startingWealth: '2d6 × 10 gp',
    classFeatures: [
      { level: 1, name: 'Nature Bond' },
      { level: 1, name: 'Nature Sense' },
      { level: 1, name: 'Orisons' },
      { level: 1, name: 'Wild Empathy' },
      { level: 2, name: 'Woodland Stride' },
      { level: 3, name: 'Trackless Step' },
      { level: 4, name: "Resist Nature's Lure" },
      { level: 4, name: 'Wild Shape (1/day)' },
      { level: 5, name: 'Wild Shape (2/day)' },
      { level: 6, name: 'Wild Shape (3/day)' },
      { level: 7, name: 'Wild Shape (4/day)' },
      { level: 8, name: 'Wild Shape (5/day)' },
      { level: 9, name: 'Venom Immunity' },
      { level: 10, name: 'Wild Shape (6/day)' },
    ],
  },
  {
    name: 'Monk',
    hitDie: 8,
    skillRanksPerLevel: 4,
    classSkills: [
      'Acrobatics',
      'Climb',
      'Craft',
      'Escape Artist',
      'Intimidate',
      'Knowledge (history)',
      'Knowledge (religion)',
      'Perception',
      'Perform',
      'Profession',
      'Ride',
      'Sense Motive',
      'Stealth',
      'Swim',
    ],
    babProgression: BABProgression.Medium,
    saves: {
      fortitude: SaveProgression.Good,
      reflex: SaveProgression.Good,
      will: SaveProgression.Good,
    },
    weaponProficiencies: [
      'Club',
      'Crossbow (light or heavy)',
      'Dagger',
      'Handaxe',
      'Javelin',
      'Kama',
      'Nunchaku',
      'Quarterstaff',
      'Sai',
      'Shortspear',
      'Short sword',
      'Shuriken',
      'Siangham',
      'Sling',
      'Spear',
    ],
    armorProficiencies: [],
    startingWealth: '1d6 × 10 gp',
    classFeatures: [
      { level: 1, name: 'AC Bonus' },
      { level: 1, name: 'Flurry of Blows' },
      { level: 1, name: 'Stunning Fist' },
      { level: 1, name: 'Unarmed Strike' },
      { level: 2, name: 'Bonus Feat' },
      { level: 2, name: 'Evasion' },
      { level: 3, name: 'Fast Movement +10 ft.' },
      { level: 3, name: 'Maneuver Training' },
      { level: 3, name: 'Still Mind' },
      { level: 4, name: 'Ki Pool (magic)' },
      { level: 4, name: 'Slow Fall 20 ft.' },
      { level: 5, name: 'High Jump' },
      { level: 5, name: 'Purity of Body' },
      { level: 6, name: 'Bonus Feat' },
      { level: 6, name: 'Fast Movement +20 ft.' },
      { level: 6, name: 'Slow Fall 30 ft.' },
      { level: 7, name: 'Ki Pool (cold iron/silver)' },
      { level: 7, name: 'Wholeness of Body' },
      { level: 8, name: 'Slow Fall 40 ft.' },
      { level: 9, name: 'Fast Movement +30 ft.' },
      { level: 9, name: 'Improved Evasion' },
      { level: 10, name: 'Bonus Feat' },
      { level: 10, name: 'Ki Pool (lawful)' },
      { level: 10, name: 'Slow Fall 50 ft.' },
    ],
  },
  {
    name: 'Paladin',
    hitDie: 10,
    skillRanksPerLevel: 2,
    classSkills: [
      'Craft',
      'Diplomacy',
      'Handle Animal',
      'Heal',
      'Knowledge (nobility)',
      'Knowledge (religion)',
      'Profession',
      'Ride',
      'Sense Motive',
      'Spellcraft',
    ],
    babProgression: BABProgression.Full,
    saves: {
      fortitude: SaveProgression.Good,
      reflex: SaveProgression.Poor,
      will: SaveProgression.Good,
    },
    weaponProficiencies: ['Simple weapons', 'Martial weapons'],
    armorProficiencies: ['Light armor', 'Medium armor', 'Heavy armor', 'Shields', 'Tower shields'],
    startingWealth: '5d6 × 10 gp',
    classFeatures: [
      { level: 1, name: 'Aura of Good' },
      { level: 1, name: 'Detect Evil' },
      { level: 1, name: 'Smite Evil 1/day' },
      { level: 2, name: 'Divine Grace' },
      { level: 2, name: 'Lay on Hands' },
      { level: 3, name: 'Aura of Courage' },
      { level: 3, name: 'Divine Health' },
      { level: 3, name: 'Mercy' },
      { level: 4, name: 'Channel Positive Energy' },
      { level: 4, name: 'Smite Evil 2/day' },
      { level: 5, name: 'Divine Bond' },
      { level: 6, name: 'Mercy' },
      { level: 7, name: 'Smite Evil 3/day' },
      { level: 8, name: 'Aura of Resolve' },
      { level: 9, name: 'Mercy' },
      { level: 10, name: 'Smite Evil 4/day' },
    ],
  },
  {
    name: 'Ranger',
    hitDie: 10,
    skillRanksPerLevel: 6,
    classSkills: [
      'Climb',
      'Craft',
      'Handle Animal',
      'Heal',
      'Intimidate',
      'Knowledge (dungeoneering)',
      'Knowledge (geography)',
      'Knowledge (nature)',
      'Perception',
      'Profession',
      'Ride',
      'Spellcraft',
      'Stealth',
      'Survival',
      'Swim',
    ],
    babProgression: BABProgression.Full,
    saves: {
      fortitude: SaveProgression.Good,
      reflex: SaveProgression.Good,
      will: SaveProgression.Poor,
    },
    weaponProficiencies: ['Simple weapons', 'Martial weapons'],
    armorProficiencies: ['Light armor', 'Medium armor', 'Shields'],
    startingWealth: '5d6 × 10 gp',
    classFeatures: [
      { level: 1, name: 'Favored Enemy' },
      { level: 1, name: 'Track' },
      { level: 1, name: 'Wild Empathy' },
      { level: 2, name: 'Combat Style Feat' },
      { level: 3, name: 'Endurance' },
      { level: 3, name: 'Favored Terrain' },
      { level: 4, name: "Hunter's Bond" },
      { level: 5, name: 'Favored Enemy' },
      { level: 6, name: 'Combat Style Feat' },
      { level: 7, name: 'Woodland Stride' },
      { level: 8, name: 'Swift Tracker' },
      { level: 8, name: 'Favored Terrain' },
      { level: 9, name: 'Evasion' },
      { level: 10, name: 'Combat Style Feat' },
      { level: 10, name: 'Favored Enemy' },
    ],
  },
  {
    name: 'Sorcerer',
    hitDie: 6,
    skillRanksPerLevel: 2,
    classSkills: [
      'Appraise',
      'Bluff',
      'Craft',
      'Fly',
      'Intimidate',
      'Knowledge (arcana)',
      'Profession',
      'Spellcraft',
      'Use Magic Device',
    ],
    babProgression: BABProgression.Low,
    saves: {
      fortitude: SaveProgression.Poor,
      reflex: SaveProgression.Poor,
      will: SaveProgression.Good,
    },
    weaponProficiencies: ['Simple weapons'],
    armorProficiencies: [],
    startingWealth: '2d6 × 10 gp',
    classFeatures: [
      { level: 1, name: 'Bloodline' },
      { level: 1, name: 'Bloodline Power' },
      { level: 1, name: 'Cantrips' },
      { level: 1, name: 'Eschew Materials' },
      { level: 3, name: 'Bloodline Power' },
      { level: 3, name: 'Bloodline Spell' },
      { level: 5, name: 'Bloodline Spell' },
      { level: 7, name: 'Bloodline Feat' },
      { level: 7, name: 'Bloodline Spell' },
      { level: 9, name: 'Bloodline Power' },
      { level: 9, name: 'Bloodline Spell' },
      { level: 10, name: 'Bloodline Feat' },
    ],
  },
];

export function getClassByName(name: string): ClassData | undefined {
  return CORE_CLASSES.find((cls) => cls.name === name);
}

export function getClassNames(): string[] {
  return CORE_CLASSES.map((cls) => cls.name);
}

// Calculate base save bonus based on level and progression
export function calculateBaseSave(level: number, progression: SaveProgression): number {
  if (progression === SaveProgression.Good) {
    return Math.floor(level / 2) + 2;
  } else {
    return Math.floor(level / 3);
  }
}

// Calculate BAB based on level and progression
export function calculateBAB(level: number, progression: BABProgression): number {
  switch (progression) {
    case BABProgression.Full:
      return level;
    case BABProgression.Medium:
      return Math.floor(level * 0.75);
    case BABProgression.Low:
      return Math.floor(level * 0.5);
  }
}
